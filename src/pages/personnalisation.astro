---
import PocketBase from "pocketbase";
import Layout from "../layouts/Layout.astro";
const pb = new PocketBase("http://127.0.0.1:8090");
const matMonture = await pb.collection("materiaux_lunette").getFullList();
const matVerres = await pb.collection("materiaux_verres").getFullList();
const couleurs = [
    { nom: "Noir", hex: "#232537" },
    { nom: "Gris", hex: "#535353" },
    { nom: "Marron", hex: "#7b4b24" },
    { nom: "Beige", hex: "#c9a66b" },
    { nom: "Blanc", hex: "#ececec" },
    { nom: "Transparent", hex: "#f7f7fa" },
];
---

<Layout title="Personnalisation - TaVue">
    <main
        class="bg-[#f6f8fe] min-h-screen flex flex-col items-center py-12 px-2"
    >
        <h1
            class="text-3xl md:text-4xl font-extrabold text-[#2563eb] mb-7 text-center tracking-tight"
        >
            Personnalisez votre paire
        </h1>
        <div
            class="w-full max-w-xl bg-white rounded-2xl shadow-lg p-8 pt-7 flex flex-col gap-7"
        >
            <div class="flex flex-col items-center gap-2">
                <svg
                    id="svg-lunette"
                    width="112"
                    height="60"
                    class="mb-1"
                    viewBox="80 100 500 250"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <g id="branches">
                        <path
                            id="branche-gauche"
                            fill="#bbb"
                            stroke="#1d1d1b"
                            stroke-width="0.5"
                            d="M108.83,155.14s49.35-5.57,54.93-8.76,11.14-7.96,19.5-9.55,64.48-11.14,64.48-11.14c0,0,7.16-1.99,17.51,5.57s33.04,31.84,39.4,31.05c6.37-.8,9.55-9.55,7.56-13.53s-40.67-32.75-47.36-34.63c-9.53-2.68-21.89-2.39-37.02,0-15.12,2.39-116.22,23.34-116.22,23.34,0,0-13.13,6.12-2.79,17.66Z"
                        ></path>
                        <path
                            id="branche-droite"
                            fill="#bbb"
                            stroke="#1d1d1b"
                            stroke-width="0.5"
                            d="M374.79,179.65l90.54-29.78s22.13-5.63,25.35-4.02,17.71,30.58,17.71,33.8-2.42,14.01-5.63,14.89c-2.33.64-5.33.11-6.84-4.21-1.41-4.02-6.84-31.73-12.47-31.47s-50.7,15.95-50.7,15.95c0,0-13.28,6.44-18.91,11.27s-32.19,11.27-32.19,11.27c0,0-9.66-7.65-6.84-17.71Z"
                        ></path>
                    </g>
                    <g id="monture">
                        <path
                            id="monture-shape"
                            fill="#232537"
                            stroke="#1d1d1b"
                            stroke-width="0.5"
                            d="M385.31,180.81c-.24-3.41-9.57-5.22-12.71-6.4-3.14-1.18-15.7,1.96-15.7,1.96-12.17-3.14-54.55-9.03-78.88-9.03s-32.57,11.38-35.32,10.99c-2.75-.39-17.27-.78-23.55-1.96-6.28-1.18-5.1-14.13-39.25-26.48-34.14-12.35-68.29-12.42-68.29-12.42-13.35,4.66-6.76,18.49-6.76,18.49l2.05,6.35c4.32,2.03,3.14,10.52,4.71,23.08s7.46,28.65,14.13,38.46c6.67,9.81,31.79,20.8,44.35,21.19s23.55-1.96,31.79-15.31c8.24-13.34,16.88-36.89,16.88-36.89l10.2,1.57s2.91.31,5.35,3.09,4.43,8.03,7.6,17.31c7.56,22.1,25.12,39.25,25.12,39.25,0,0,5.6,7.43,33.44,12.66,23.08,4.34,42.7-2.46,42.7-2.46,17.72-7.17,21.63-44.96,21.63-44.96,0,0,1.83-13.3,7.81-16.65,7.37-4.14,8.27-4.44,12.71-5.32,3.61-.71.24-13.13,0-16.54Z"
                        ></path>
                    </g>
                </svg>
                <input
                    type="text"
                    class="w-full px-4 py-2 rounded-xl border border-[#daedfb] shadow focus:outline-none text-base bg-[#f6f8fe]"
                    placeholder="Nom du modèle"
                />
            </div>
            <div class="flex flex-col gap-6">
                <div>
                    <div class="font-bold text-[#2563eb] mb-3 text-lg">
                        1. MATÉRIAU
                    </div>
                    <div class="flex flex-wrap gap-3">
                        {
                            matMonture.map((mat, i) => (
                                <button
                                    type="button"
                                    class={`option-btn${i === 0 ? " selected-btn" : ""}`}
                                    onclick={`document.querySelectorAll('.option-btn').forEach(btn=>btn.classList.remove('selected-btn')); this.classList.add('selected-btn'); window.prixMat=${mat.prix_materiaux}; updatePrix();`}
                                >
                                    {mat.nom_materiaux}{" "}
                                    <span class="option-price">
                                        +{mat.prix_materiaux}€
                                    </span>
                                </button>
                            ))
                        }
                    </div>
                </div>
                <div>
                    <div class="font-bold text-[#2563eb] mb-3 text-lg">
                        2. TYPE DE VERRE
                    </div>
                    <div class="flex flex-wrap gap-3">
                        {
                            matVerres.map((verre, i) => (
                                <button
                                    type="button"
                                    class={`option-btn${i === 0 ? " selected-btn" : ""}`}
                                    onclick={`document.querySelectorAll('.option-btn.vertes').forEach(btn=>btn.classList.remove('selected-btn')); this.classList.add('selected-btn'); window.prixVerre=${verre.prix_verre}; updatePrix();`}
                                    class="option-btn vertes"
                                >
                                    {verre.nom_verres}{" "}
                                    <span class="option-price">
                                        +{verre.prix_verre}€
                                    </span>
                                </button>
                            ))
                        }
                    </div>
                </div>
                <div>
                    <div class="font-bold text-[#2563eb] mb-3 text-lg">
                        3. COULEUR MONTURE
                    </div>
                    <div class="flex flex-row gap-2">
                        {
                            couleurs.map((c) => (
                                <button
                                    type="button"
                                    class="color-btn"
                                    style={`background:${c.hex}`}
                                    onclick={`document.querySelectorAll('.color-btn.monture').forEach(btn=>btn.classList.remove('selected-color')); this.classList.add('selected-color'); document.getElementById('monture-shape').setAttribute('fill', '${c.hex}');`}
                                    class="color-btn monture"
                                />
                            ))
                        }
                    </div>
                </div>
                <div>
                    <div class="font-bold text-[#2563eb] mb-3 text-lg">
                        4. COULEUR BRANCHES
                    </div>
                    <div class="flex flex-row gap-2">
                        {
                            couleurs.map((c) => (
                                <button
                                    type="button"
                                    class="color-btn"
                                    style={`background:${c.hex}`}
                                    onclick={`document.querySelectorAll('.color-btn.branche').forEach(btn=>btn.classList.remove('selected-color')); this.classList.add('selected-color'); document.getElementById('branche-gauche').setAttribute('fill', '${c.hex}'); document.getElementById('branche-droite').setAttribute('fill', '${c.hex}');`}
                                    class="color-btn branche"
                                />
                            ))
                        }
                    </div>
                </div>
            </div>
            <div class="flex w-full items-center justify-between mt-2">
                <div class="text-[#2563eb] text-lg font-extrabold">
                    Prix total :
                </div>
                <div id="prixFinal" class="text-lg font-extrabold ml-2">0€</div>
            </div>
            <button
                class="w-full mt-4 bg-gradient-to-r from-[#2563eb] to-[#6eb2fa] hover:from-[#539cf3] text-white text-lg font-bold rounded-xl py-3 transition"
                >Sauvegarder</button
            >
        </div>
        <script>
            window.prixMat = 0;
            window.prixVerre = 0;
            function updatePrix() {
                document.getElementById("prixFinal").textContent =
                    window.prixMat + window.prixVerre + "€";
            }
        </script>
        <style>
            .option-btn {
                border: 2px solid #d3e8ff;
                background: #f6f8fe;
                border-radius: 16px;
                padding: 0.6em 1.4em;
                font-size: 1.08rem;
                font-weight: 600;
                color: #212336;
                cursor: pointer;
                outline: none;
                transition: all 0.18s;
            }
            .option-btn.selected-btn,
            .option-btn:focus {
                background: #e3f1ff;
                color: #2563eb;
                border-color: #2563eb;
            }
            .option-btn:hover {
                border-color: #2563eb;
                color: #2563eb;
                background: #e3f1ff;
            }
            .option-price {
                font-size: 1em;
                margin-left: 0.4em;
                color: #7c8dac;
                font-weight: 400;
            }
            .color-btn {
                width: 35px;
                height: 35px;
                border-radius: 12px;
                border: 2px solid #e2eaf8;
                cursor: pointer;
                transition: all 0.12s;
                margin-bottom: 0.09em;
                outline: none;
            }
            .color-btn.selected-color {
                border-color: #2563eb;
                box-shadow: 0 0 8px #2563eb11;
            }
            .color-btn:hover,
            .color-btn:focus {
                border-color: #2563eb;
            }
        </style>
    </main>
</Layout>
